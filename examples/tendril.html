<html>


  <head>
    <style>
      #container{ position:absolute; left:0px; top:0px; z-index:0; width:100%; height:100%; display:block; overflow:hidden}
      body{ margin:0px; }
    </style>
  </head>

  <body>
    <div id="container"></div>


    <script src="../lib/three.js"></script>
    <script src="../lib/jquery.min.js"></script>
    <script src="../lib/TrackballControls.js"></script>
    <script src="../lib/ShaderLoader.js"></script>
    <script src="../lib/dat.gui.min.js"></script>

    <script src="../lib/AudioController.js"></script>
    <script src="../lib/AudioTexture.js"></script>
    <script src="../lib/Stream.js"></script>
    <script src="../lib/UserAudio.js"></script>
    <script src="../lib/underscore.js"></script>

    <script src="../ParticleUtils.js"></script>
    <script src="../PhysicsRenderer.js"></script>


    <script src="js/Tendrils.js"></script>


     <script>


      var centerPaused, movementPaused , physicsPaused = false;

      var audioController = new AudioController();
      
      
      
      audioController.mute.gain.value = 0.0;

      var userAudio = new UserAudio( audioController );
      
      userAudio.onStreamCreated = function(){
        init();
        animate();
      }

      var stream = new Stream( '../../audio/saturnStrobe.mp3' , audioController );
      //stream.play();


      
      var t_audio = audioController.texture;
      console.log( t_audio );
      
      var camera, renderer, scene , controls , clock;

      var center;

      var colors = [];
      var gui = new dat.GUI({});

      var particleSystem;
      var physicsRenderer , uniforms;

      var leader;

      var dT = { type:"f" , value:0 }

      var timer = { type:"f" , value:0 };

      var furryTails = [];
      var cloth;

      var shaders = new ShaderLoader('../shaders');

      shaders.shaderSetLoaded = function(){
       /* init();
        animate();
        stream.play();*/
      }

      shaders.load( 'vs-tendril' , 'tendril' , 'vertex' );
      shaders.load( 'fs-tendril' , 'tendril' , 'fragment' );

      shaders.load( 'tendrilSim'  , 'tendrilSim' , 'simulation'  );

      function init(){

        /*

          THREE.js Initialization

        */

        var w = window.innerWidth;
        var h = window.innerHeight;

        camera = new THREE.PerspectiveCamera( 65 , w/h , 1 , 200000 );
        camera.position.z = 100;

        //controls = new THREE.TrackballControls( camera );
        scene = new THREE.Scene();

        clock = new THREE.Clock();

        renderer = new THREE.WebGLRenderer({autoclear:false});
        renderer.setSize( window.innerWidth, window.innerHeight );

        var container = document.getElementById('container' );
        controls = new THREE.TrackballControls( camera , container );
        container.appendChild( renderer.domElement );


        center = new THREE.Mesh( 
          new THREE.IcosahedronGeometry( 10 , 0 ),
          new THREE.MeshNormalMaterial()
        );


        tendrils = new Tendrils();

        window.addEventListener( 'resize', onResize , false );
        
        document.addEventListener( 'keydown' , function(e){

          console.log( e.which );
          if( e.which == 32 ){

            centerPaused = !centerPaused;

          }

          if( e.which == 45 ){

            physicsPaused = !physicsPaused;

          }

          if( e.which == 90 ){

            movementPaused = !movementPaused;

          }



        });
      }



      function animate(){

        //console.log( 

        dT.value = clock.getDelta();

        timer.value += dT.value;

        audioController.update();

        if( !physicsPaused ){
          tendrils.update();
        }

       /* if( !centerPaused ){

          center.position.x = Math.sin( timer.value * 1.73 ) * 12;
          center.position.y = Math.cos( timer.value * 1.3 ) * 12;
          center.position.z = Math.cos( timer.value * 2) * 10;

        }*/

        //physicsRenderer.update();

        requestAnimationFrame( animate );
        controls.update();
        renderer.render( scene , camera );

      }

       function onResize() {
        windowHalfX = window.innerWidth / 2;
        windowHalfY = window.innerHeight / 2;
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }



    </script>

  </body>
</html>
